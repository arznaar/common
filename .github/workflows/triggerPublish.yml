on:
  # pull_request:
  #   # types: [ closed ]
  #   branches:
  #     - develop
  workflow_dispatch

concurrency: triggerPublish

jobs:
  trigger_on_merge:
    # if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v4
        with:
          script: |
            const { owner, repo } = context.repo;
            const pulls = await github.pulls.list({ owner, repo, state: 'open' }).then((x) => x.data);
            const openAutoMergePrs = pulls.some((x) => x.auto_merge !== null);
            if (openAutoMergePrs) { return; }
            github.actions.createWorkflowDispatch({
              owner,
              repo,
              workflow_id: '.github/workflows/publish.yml',
              ref: 'refs/heads/develop',
            });
