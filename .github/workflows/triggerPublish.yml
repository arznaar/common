on:
  # pull_request:
  #   # types: [ closed ]
  #   branches:
  #     - develop
  workflow_dispatch

jobs:
  trigger_on_merge:
    # if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v4
        with:
          script: |
            console.log({ context, repo: context.repo });
            const { owner, repo } = context.repo;
            console.log({ owner, repo });
            const pulls = await github.rest.pulls.list({ owner, repo, state: 'open' }).then((x) => x.data);
            console.log(pulls);
            const openAutomergePrs = pulls.some((x) => x.auto_merge !== null));
            if (openAutomergePrs) { return; }
            github.rest.actions.createWorkflowDispatch({
              owner,
              repo,
              workflow_id: '.github/workflows/publish.yml',
              ref: 'refs/heads/develop',
            });
